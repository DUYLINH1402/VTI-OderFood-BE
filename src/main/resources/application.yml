# ===========================================
# Application Configuration - Base (Cấu hình chung)
# File này chứa các cấu hình dùng chung cho tất cả môi trường
# Profile mặc định: local
# ===========================================

server:
  port: 8080
  forward-headers-strategy: framework # Để Spring Boot nhận biết proxy headers (X-Forwarded-For, X-Forwarded-Proto)
spring:
  profiles:
    active: local  # Profile mặc định khi chạy ở local

  jpa:
    hibernate:
      # TODO: Đổi lại 'validate' sau khi database đã được cập nhật xong
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

  # OAuth2 Client Configuration (Google & Facebook Authorization Code Flow)
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope:
              - email
              - profile
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
          facebook:
            client-id: ${FACEBOOK_APP_ID}
            client-secret: ${FACEBOOK_APP_SECRET}
            scope:
              - email
              - public_profile
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub
          facebook:
            authorization-uri: https://www.facebook.com/v18.0/dialog/oauth
            token-uri: https://graph.facebook.com/v18.0/oauth/access_token
            user-info-uri: https://graph.facebook.com/me?fields=id,name,email,picture.width(250)
            user-name-attribute: id

# ===========================================
# JWT Configuration
# ===========================================
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}

# ===========================================
# AWS S3 Configuration
# ===========================================
aws:
  region: ${AWS_REGION:ap-southeast-1}
  access-key: ${AWS_ACCESS_KEY_ID}
  secret-key: ${AWS_SECRET_ACCESS_KEY}
  s3:
    bucket-name: foodorder-images

# ===========================================
# Brevo Email Configuration
# ===========================================
brevo:
  api-key: ${BREVO_API_KEY}
  sender-email: ${BREVO_SENDER_EMAIL}

# ===========================================
# App Configuration
# ===========================================
app:
  frontend:
    reset-password-url: ${RESET_PASSWORD_URL}
    oauth2-redirect-url: ${OAUTH2_REDIRECT_URL}
  # Contact module configuration
  admin:
    email: ${ADMIN_EMAIL:admin@dongxanhfood.com}
  store:
    name: ${STORE_NAME:Dong Xanh Food}

# ===========================================
# Google OAuth 2.0 Configuration
# ===========================================
google:
  client-id: ${GOOGLE_CLIENT_ID}
  client-secret: ${GOOGLE_CLIENT_SECRET}

# ===========================================
# Facebook OAuth 2.0 Configuration
# ===========================================
facebook:
  app-id: ${FACEBOOK_APP_ID}
  app-secret: ${FACEBOOK_APP_SECRET}

# ===========================================
# ZaloPay Configuration
# ===========================================
zalopay:
  app-id: ${ZALOPAY_APP_ID}
  key1: ${ZALOPAY_KEY1}
  key2: ${ZALOPAY_KEY2}
  endpoint: https://sb-openapi.zalopay.vn/v2/create
  callback-url: ${ZALOPAY_CALLBACK_URL}
  redirect-url: ${ZALOPAY_REDIRECT_URL}

# ===========================================
# OpenAI Configuration (Chatbot)
# ===========================================
openai:
  api-key: ${OPENAI_API_KEY}
  model: gpt-4o
  max-tokens: 1000
  temperature: 0.7

# ===========================================
# Algolia Search Configuration
# ===========================================
algolia:
  application-id: ${ALGOLIA_APPLICATION_ID}
  api-key: ${ALGOLIA_API_KEY}
  index-name: ${ALGOLIA_INDEX_NAME:foods}
# ===========================================
# SpringDoc OpenAPI (Swagger)
# ===========================================
springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui
    operations-sorter: method
    tags-sorter: alpha
    try-it-out-enabled: true
    filter: true
    display-request-duration: true
    disable-swagger-default-url: true
  show-actuator: false
  packages-to-scan: com.foodorder.backend
  paths-to-match: /api/**

# ===========================================
# Chatbot RAG Configuration
# ===========================================
chatbot:
  knowledge-base:
    update-interval: 3600000
  context:
    max-history: 20
    similarity-threshold: 0.7

# ===========================================
# Logging Configuration
# ===========================================
logging:
  level:
    com.foodorder.backend.coupons: DEBUG
    org.springframework.scheduling: INFO


